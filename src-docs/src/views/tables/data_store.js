import { Comparators } from '../../../../src/services/sort';
import { Random } from '../../../../src/services/random';
import { times } from '../../../../src/services/utils';

const random = new Random();

const createCountries = () => [
  { code: 'NL', name: 'Netherlands', flag: 'ðŸ‡³ðŸ‡±' },
  { code: 'CZ', name: 'Czech Republic', flag: 'ðŸ‡¨ðŸ‡¿' },
  { code: 'ZA', name: 'South Africa', flag: 'ðŸ‡¿ðŸ‡¦' },
  { code: 'US', name: 'United States', flag: 'ðŸ‡ºðŸ‡²' },
  { code: 'AU', name: 'Australia', flag: 'ðŸ‡¦ðŸ‡º' },
  { code: 'IL', name: 'Israel', flag: 'ðŸ‡®ðŸ‡±' },
  { code: 'NO', name: 'Norway', flag: 'ðŸ‡³ðŸ‡´' },
  { code: 'IT', name: 'Italy', flag: 'ðŸ‡®ðŸ‡¹' },
  { code: 'CA', name: 'Canada', flag: 'ðŸ‡¨ðŸ‡¦' },
  { code: 'CG', name: 'Congo', flag: 'ðŸ‡¨ðŸ‡¬' },
  { code: 'CL', name: 'Chile', flag: 'ðŸ‡¨ðŸ‡±' },
  { code: 'FJ', name: 'Fiji', flag: 'ðŸ‡«ðŸ‡¯' },
  { code: 'GB', name: 'United Kingdom', flag: 'ðŸ‡¬ðŸ‡§' },
  { code: 'GR', name: 'Greece', flag: 'ðŸ‡¬ðŸ‡·' },
  { code: 'HT', name: 'Haiti', flag: 'ðŸ‡­ðŸ‡¹' },
  { code: 'LB', name: 'Lebanon', flag: 'ðŸ‡±ðŸ‡§' },
  { code: 'MM', name: 'Myanmar', flag: 'ðŸ‡²ðŸ‡²' },
  { code: 'MX', name: 'Mexico', flag: 'ðŸ‡²ðŸ‡½' },
  { code: 'NG', name: 'Nigeria', flag: 'ðŸ‡³ðŸ‡¬' },
  { code: 'SG', name: 'Singapore', flag: 'ðŸ‡¸ðŸ‡¬' },
  { code: 'SO', name: 'Somalia', flag: 'ðŸ‡¸ðŸ‡´' },
  { code: 'TN', name: 'Tunisia', flag: 'ðŸ‡¹ðŸ‡³' },
  { code: 'VE', name: 'Venezuela', flag: 'ðŸ‡»ðŸ‡ª' },
  { code: 'ZM', name: 'Zambia', flag: 'ðŸ‡¿ðŸ‡²' },
];

const createUsers = (countries) => {
  return times(20, (index) => {
    return {
      id: index,
      firstName: random.oneOf('Martijn', 'Elissa', 'Clinton', 'Igor', 'Karl', 'Drew', 'Honza', 'Rashid', 'Jordan'),
      lastName: random.oneOf('van Groningen', 'Weve', 'Gormley', 'Motov', 'Minarik', 'Raines', 'KrÃ¡l', 'Khan', 'Sissel'),
      github: random.oneOf('martijnvg', 'elissaw', 'clintongormley', 'imotov', 'karmi', 'drewr', 'HonzaKral', 'rashidkpc', 'jordansissel'),
      dateOfBirth: random.date({ min: new Date(1971, 0, 0), max: new Date(1990, 0, 0) }),
      nationality: random.oneOf(...countries.map(country => country.code)),
      online: random.boolean()
    };
  });
};

export const createDataStore = () => {
  const countries = createCountries();
  const users = createUsers(countries);
  return {
    countries,
    users,

    findUsers: (pageIndex, pageSize, sort) => {
      let list = users;
      if (sort) {
        list = users.sort(Comparators.property(sort.field, Comparators.default(sort.direction)));
      }
      if (!pageIndex && !pageSize) {
        return {
          index: 0,
          size: list.length,
          items: list,
          totalRecordCount: list.length
        };
      }
      const from = pageIndex * pageSize;
      const items = list.slice(from, Math.min(from + pageSize, list.length));
      return {
        index: pageIndex,
        size: pageSize,
        items,
        totalCount: list.length
      };
    },

    deleteUsers: (...ids) => {
      ids.forEach(id => {
        const index = users.findIndex(user => user.id === id);
        if (index >= 0) {
          users.splice(index, 1);
        }
      });
    },

    cloneUser: (id) => {
      const index = users.findIndex(user => user.id === id);
      if (index >= 0) {
        const user = users[index];
        users.splice(index, 0, { ...user, id: users.length });
      }
    },

    getCountry: (code) => countries.find(country => country.code === code)
  };
};
